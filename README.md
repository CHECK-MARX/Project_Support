# サポート受付ディレクトリ作成ツール

PowerShell で動作するサポート業務向けのディレクトリ／ノート管理ツールです。サポート番号や顧客情報を入力すると、案件フォルダーの作成・既存案件の検索・対応メモの追記を一括で行えます。GUI は Windows Forms を利用しており、PowerShell 5.1 を搭載した Windows 環境で動作します。

---

## 前提条件

- Windows 10 以降（PowerShell 5.1 を利用）
- `SupportCaseManager.ps1` を実行できる権限（既定では ExecutionPolicy が `RemoteSigned` 以上であれば実行可能）
- サポート案件を格納するルートフォルダー（例: `C:\SupportCases`）

---

## ファイル／フォルダー構成と役割

| パス | 役割 |
|------|------|
| `SupportCaseManager.ps1` | メインスクリプト。GUI 生成から履歴管理・ノート追記までアプリ全体のロジックを担います。 |
| `LaunchSupportCaseManager.cmd` | ダブルクリックでツールを起動するためのバッチ。PowerShell を呼び出して `SupportCaseManager.ps1` を実行します。 |
| `src/button-accent.patch.ps1` | ボタンの描画とホバー演出を調整する軽量パッチ。 |
| `src/openonly.patch.ps1` | ノート編集ボタンを「開く専用」にし、Notepad 起動と状態管理を担うパッチ。 |
| `src/persist-darkmode.min.ps1` | フォーム初期化後にダークテーマ設定を再適用しつつ保存するパッチ（Idle フック版）。 |
| `src/persist-darkmode.patch.ps1` | メニューやチェックボックスの状態と連動させたダークテーマ永続化の拡張パッチ。 |
| `bak/` | 任意で旧版スクリプトを退避するためのフォルダー（初期状態では空）。 |
| `config/user-settings.json`（実行時生成） | ダークテーマ設定を保持する JSON。存在しない場合は自動生成されます。 |
| `SupportCaseManager.log`（実行時生成） | 実行ログ。エラー調査に利用します。 |

---

## 導入手順（初回）

1. **フォルダーを配置**  
   プロジェクト一式を任意の場所（例: `C:\Tools\Support`）に展開します。  
   以降の説明では、このディレクトリを「ツールフォルダー」と呼びます。

2. **ExecutionPolicy の確認（必要に応じて）**  
   PowerShell を管理者として起動し、以下のコマンドで実行ポリシーを確認・設定します。
   ```powershell
   Get-ExecutionPolicy
   # RemoteSigned 未満の場合、次を実行
   Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```

3. **LaunchSupportCaseManager.cmd を実行**  
   ツールフォルダー直下の `LaunchSupportCaseManager.cmd` をダブルクリックすると、PowerShell で GUI が起動します。  
   コマンドラインから起動する場合は次を実行します。
   ```powershell
   powershell.exe -ExecutionPolicy Bypass -File .\SupportCaseManager.ps1
   ```

4. **初回設定**  
   - 画面上部の「ベースフォルダ」にサポート案件を保管するルートを設定します。  
     例: `C:\SupportCases`  
     「参照…」ボタンでフォルダ選択ダイアログを開けます。  
   - 必要に応じてダークテーマにチェックを入れると、以降は自動でテーマを記憶します。

---

## 使い方（基本フロー）

1. **案件を検索／読み込み**  
   - 「サポート番号検索」にサポート ID を入力して「検索」ボタン。  
   - 履歴コンボボックスから過去案件を選択。  
   既存案件が見つかると情報が自動で入力され、案件フォルダが開きます。

2. **新規案件の作成**  
   - 受付日／会社名／サポート番号／ステータスを入力。  
   - 画面下部の「フォルダ作成」をクリック。  
   - 指定したベースフォルダ配下に `YYYYMMDD(会社名_サポート番号)ステータス` の形式で案件フォルダが生成され、初期ノートファイルが作られます。  
   - 「作成後にフォルダを開く」にチェックがあれば、エクスプローラーが開きます。

3. **ノートの追記**  
   各メモ欄（お客様ご相談内容／お客様への返信案／メーカー連携内容）にテキストを入力し、「追記保存」を押すと、案件フォルダ内の該当テキストファイルに日付付きの追記が行われます。

4. **外部ファイルとのリンク**  
   - 「選択…」ボタンで既存テキストを選び、案件フォルダへコピー／リネーム可能。  
   - 「開く」「閉じる」でメモファイルをメモ帳で開閉できます。

5. **案件フォルダの操作**  
   - 「フォルダを閉じる」ボタンでエクスプローラーを自動的に閉じることができます。  
   - 右上の「履歴クリア」で履歴一覧をリセットできます（`cases-index.json` が削除されますので注意）。

---

## よくある操作

- **テーマ切り替え**: 画面左下の「ダークテーマ」にチェックを入れると即時反映され、次回起動時も同じテーマが適用されます。  
- **ログ確認**: 予期せぬエラーが発生した場合は `SupportCaseManager.log` を参照してください。検索ボタンなど主要操作は try/catch を備えており、詳細メッセージがログに出力されます。  
- **バックアップ**: `bak/` フォルダーに過去のスクリプトや補助ファイルを保管しています。現行バージョンの動作には不要ですが、必要に応じて参照・復元できます。  
- **設定ファイル**: ツール直下に `config/user-settings.json` が生成され、テーマ設定が保存されます。別端末へ移行する場合はこの JSON をコピーしてください。  

---

## トラブルシューティング

| 症状 | 対処 |
|------|------|
| スクリプト起動時に実行ポリシーエラー | PowerShell を管理者として開き `Set-ExecutionPolicy RemoteSigned -Scope CurrentUser` を実行する。 |
| 検索ボタン押下でエラー | `SupportCaseManager.log` に詳細が出力されます。アクセスできないサブフォルダーがある場合でもツールは継続動作します。 |
| ダークテーマが保持されない | ツール直下の `config/user-settings.json` に `{"DarkMode": true}` など設定が保存されているか確認してください。フォルダへの書き込み権限がない場合は手動作成でも対応可。 |
| 旧バージョンが必要 | `bak/` に保存されている過去の `.ps1` を参照してください。 |

---

## アップデートしていきたい点（メモ）

- 複数人同時利用時の履歴共有（`cases-index.json` の共有フォルダ化など）
- ノートファイル以外（Excel, PDF 等）の添付管理
- GUI の多言語化

---

## ライセンス／変更履歴

本ツールは社内利用向けに作成されたスクリプトです。社外提供時には、利用規約・ライセンスを別途整備してください。最新版は `SupportCaseManager.ps1` の Git 履歴、必要に応じて `bak/` に退避したバックアップを参照してください。
